<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" /> <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]--> <meta name="author" content="Chi Yuanye"> <!--highlight--> <link rel="stylesheet" href="/css/main.css"> <link rel="stylesheet" type="text/css" href="/assets/css/syntax.monokai.css"> <link rel="shortcut icon" href="https://i.loli.net/2019/02/20/5c6cf0555ffe6.jpeg" /> <link rel="canonical" href="http://localhost:4000/2019/01/10/MongoDB.html"> <!-- Begin Jekyll SEO tag v2.5.0 --> <title>数据库-MongoDB使用 | 池元烨的博客</title> <meta name="generator" content="Jekyll v3.8.5" /> <meta property="og:title" content="数据库-MongoDB使用" /> <meta name="author" content="Chi Yuanye" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="简介 NoSQL(Not Only SQL) 拥护者们提倡运用非关系型的数据存储。 关系型数据库遵循ACID原则: Atomicity 原子性 事务里的操作要么全部做完，要么全不做 Consistency 一致性 数据库要一直处于一直的状态，事务的运行不会改变数据库原本的一致性约束 Isolation 独立性 并发的事物之间不会相互影响。如果一个事务正在访问的数据正在被另一个事务修改，只要另一个事务未提交 Durability 持久性 一旦事务提交后，所做出的修改就会永久的保存在数据库中，即使出现宕机也不会丢失。" /> <meta property="og:description" content="简介 NoSQL(Not Only SQL) 拥护者们提倡运用非关系型的数据存储。 关系型数据库遵循ACID原则: Atomicity 原子性 事务里的操作要么全部做完，要么全不做 Consistency 一致性 数据库要一直处于一直的状态，事务的运行不会改变数据库原本的一致性约束 Isolation 独立性 并发的事物之间不会相互影响。如果一个事务正在访问的数据正在被另一个事务修改，只要另一个事务未提交 Durability 持久性 一旦事务提交后，所做出的修改就会永久的保存在数据库中，即使出现宕机也不会丢失。" /> <link rel="canonical" href="http://localhost:4000/2019/01/10/MongoDB.html" /> <meta property="og:url" content="http://localhost:4000/2019/01/10/MongoDB.html" /> <meta property="og:site_name" content="池元烨的博客" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2019-01-10T00:00:00+08:00" /> <script type="application/ld+json"> {"description":"简介 NoSQL(Not Only SQL) 拥护者们提倡运用非关系型的数据存储。 关系型数据库遵循ACID原则: Atomicity 原子性 事务里的操作要么全部做完，要么全不做 Consistency 一致性 数据库要一直处于一直的状态，事务的运行不会改变数据库原本的一致性约束 Isolation 独立性 并发的事物之间不会相互影响。如果一个事务正在访问的数据正在被另一个事务修改，只要另一个事务未提交 Durability 持久性 一旦事务提交后，所做出的修改就会永久的保存在数据库中，即使出现宕机也不会丢失。","author":{"@type":"Person","name":"Chi Yuanye"},"@type":"BlogPosting","url":"http://localhost:4000/2019/01/10/MongoDB.html","headline":"数据库-MongoDB使用","dateModified":"2019-01-10T00:00:00+08:00","datePublished":"2019-01-10T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2019/01/10/MongoDB.html"},"@context":"http://schema.org"}</script> <!-- End Jekyll SEO tag --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="池元烨的博客" /> <meta name="baidu-site-verification" content="8IPSO1rIOM" /> <script src="/assets/js/prefixfree.js"></script> <!--百度推送--> <script> (function(){ var bp = document.createElement('script'); var curProtocol = window.location.protocol.split(':')[0]; if (curProtocol === 'https') { bp.src = 'https://zz.bdstatic.com/linksubmit/push.js'; } else { bp.src = 'http://push.zhanzhang.baidu.com/push.js'; } var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(bp, s); })(); </script> </head> <body> <aside id="sidebar" class="open"> <div id="sidebar-left"> <a id="sidebar-avatar" href="/"> <img id="sidebar-avatar-img" alt="" src="https://i.loli.net/2019/02/20/5c6cf0e7a42f9.jpg"/> </a> <div id="sidebar-social"> <a href="/pages/feed.xml" class="sidebar-social-icon feed"></a> <a href="mailto:yeyuan1489@gmail.com" class="sidebar-social-icon email"></a> <!-- Generate icon by yourself https://icomoon.io/app/#/select --> <a href="https://github.com/tsiye" class="sidebar-social-icon github" target="_blank"></a> <a href="https://www.instagram.com/tsiyuye" class="sidebar-social-icon instagram" target="_blank"></a> </div> <ul id="sidebar-tags"> <li class="sidebar-tag active" data-filter="recent">最新文章</li> <li class="sidebar-tag" data-filter="应用向">应用向</li> <li class="sidebar-tag" data-filter="读书笔记">读书笔记</li> <li class="sidebar-tag" data-filter="技术向">技术向</li> <li class="sidebar-tag" data-filter="理解向">理解向</li> <li class="sidebar-tag" data-filter="算法">算法</li> </ul> </div> <div id="sidebar-right"> <div id="search-box"> <input id="search-input" type="text" placeholder="Search" /> </div> <nav id="toc"> <a class="toc-link" data-tags="应用向" href="/2019/06/06/test.html"> Java大作业test </a> <a class="toc-link" data-tags="读书笔记" href="/2019/05/08/introduction-to-algo-DP.html"> 《算法导论》-动态规划问题 </a> <a class="toc-link" data-tags="" href="/2019/05/08/DP.html"> Dp </a> <a class="toc-link" data-tags="算法" href="/2019/04/26/external-sort2.html"> 算法-外部排序2 </a> <a class="toc-link" data-tags="应用向" href="/2019/04/22/github-ssh.html"> Git-关于github由https转为ssh </a> <a class="toc-link" data-tags="算法" href="/2019/04/20/single-and-double-linkedlist.html"> 数据结构-单双链表的区别 </a> <a class="toc-link" data-tags="应用向" href="/2019/04/16/blog-construction.html"> 本技术博客的搭建 </a> <a class="toc-link" data-tags="算法" href="/2019/04/16/external-sort.html"> 算法-外部排序1 </a> <a class="toc-link" data-tags="读书笔记" href="/2019/04/15/java-tools-3.html"> Java-《Java语言程序设计》关于一些工具数据类型的用法总结(二) 线性表list </a> <a class="toc-link" data-tags="读书笔记" href="/2019/04/15/java-tools-2.html"> Java-《Java语言程序设计》关于一些工具数据类型的用法总结(二) 合集collection和迭代器iterator </a> <a class="toc-link" data-tags="应用向" href="/2019/04/11/ss.html"> ubuntu-ss的一些配置 </a> <a class="toc-link" data-tags="理解向" href="/2019/03/30/file-descriptor.html"> 操作系统-文件描述符 </a> <a class="toc-link" data-tags="技术向" href="/2019/03/28/Nagel.html"> 网络-Nagel算法＆Delay ACK </a> <a class="toc-link" data-tags="技术向" href="/2019/03/28/redis.html"> 数据库-Redis类型和使用场景 </a> <a class="toc-link" data-tags="理解向" href="/2019/03/26/java-PrintStream-PrintWriter.html"> Java-IO总览 </a> <a class="toc-link" data-tags="算法" href="/2019/03/26/PLS.html"> 算法-PLS(偏最小二乘回归)以及相关概念 </a> <a class="toc-link" data-tags="应用向" href="/2019/03/24/ubuntu-tools.html"> ubuntu-一些好用的工具 </a> <a class="toc-link" data-tags="算法" href="/2019/03/24/backtracking.html"> 算法-backtracking(回溯法) </a> <a class="toc-link" data-tags="技术向" href="/2019/03/19/java-comparator-comparable.html"> Java-comparator & comparable </a> <a class="toc-link" data-tags="算法" href="/2019/03/18/sentinel.html"> 算法-哨兵 </a> <a class="toc-link" data-tags="算法" href="/2019/03/18/resources.html"> 算法-一些资源 </a> <a class="toc-link" data-tags="应用向" href="/2019/03/16/zsh-hot-key.html"> zsh-快捷键 </a> <a class="toc-link" data-tags="读书笔记" href="/2019/03/11/java-tools-1.html"> Java-《Java语言程序设计》关于一些工具数据类型的用法总结(一) 数组 Math 字符串 </a> <a class="toc-link" data-tags="读书笔记" href="/2019/03/10/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F.html"> 《深入理解计算机系统》 </a> <a class="toc-link" data-tags="应用向" href="/2019/03/09/ps-vs-top.html"> 操作系统-ps & top </a> <a class="toc-link" data-tags="读书笔记" href="/2019/03/09/%E7%8E%B0%E4%BB%A3%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.html"> 现代操作系统-第一章-引论 </a> <a class="toc-link" data-tags="算法" href="/2019/03/09/operators.html"> 算法-运算符 </a> <a class="toc-link" data-tags="应用向" href="/2019/03/07/tcpip-osi.html"> 网络-TCP/IP&OSI </a> <a class="toc-link" data-tags="理解向" href="/2019/03/07/http-https.html"> 网络-Http&Https </a> <a class="toc-link" data-tags="技术向" href="/2019/03/06/socks.html"> 网络-socks </a> <a class="toc-link" data-tags="理解向" href="/2019/03/06/efficiency-of-server.html"> 操作系统-影响服务器性能的四大杀手 </a> <a class="toc-link" data-tags="理解向" href="/2019/03/05/dirty-read-nonrepeatable-read-phantom-read.html"> 数据库&分布式-脏读，幻读，不可重复读 事务的隔离性 </a> <a class="toc-link" data-tags="技术向" href="/2019/03/05/MongoDB-Redis-Memcached.html"> 数据库-Redis，Memcached,MongoDB比较 </a> <a class="toc-link" data-tags="技术向" href="/2019/03/05/ACID-CAP.html"> 数据库&分布式-ACID & CAP/BASE </a> <a class="toc-link" data-tags="技术向" href="/2019/03/04/db-type.html"> 数据库-大致分类 </a> <a class="toc-link" data-tags="算法" href="/2019/03/04/sort.html"> 算法-几种排序的介绍 </a> <a class="toc-link" data-tags="理解向" href="/2019/03/03/limited-server.html"> 网络-服务器限流以及突破服务器限流, 爬虫与反爬 </a> <a class="toc-link" data-tags="应用向" href="/2019/03/03/java-path.html"> Java环境配置 </a> <a class="toc-link" data-tags="应用向" href="/2019/03/03/git.html"> 技巧-git命令汇总 </a> <a class="toc-link" data-tags="算法" href="/2019/03/03/rand.html"> 算法-一种rand表示另一种 </a> <a class="toc-link" data-tags="应用向" href="/2019/03/02/docker.html"> docker </a> <a class="toc-link" data-tags="理解向" href="/2019/03/01/pyspider%E9%98%85%E8%AF%BB%E8%AE%B0.html"> 源码阅读-pyspider源码阅读3 tornado_fetcher.py </a> <a class="toc-link" data-tags="应用向" href="/2019/02/28/messagepack.html"> 网络-Python-messagePack </a> <a class="toc-link" data-tags="理解向" href="/2019/02/28/copy-&-deepcopy.html"> 语言-Python-深浅拷贝 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/27/Python-metaclass.html"> 语言-Python-元类 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/27/in-memry-vs-on-disk.html"> 数据库-内存数据库和磁盘数据库的对比 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/26/pyspider%E9%98%85%E8%AF%BB%E8%AE%B0.html"> 源码阅读-pyspider源码阅读2 app.py </a> <a class="toc-link" data-tags="理解向" href="/2019/02/26/Tornado.html"> 网络-Python-Tornado </a> <a class="toc-link" data-tags="理解向" href="/2019/02/26/Multiplexing.html"> 网络&操作系统-IO多路复用 select poll epoll </a> <a class="toc-link" data-tags="技术向" href="/2019/02/26/Gevent.html"> 网络-Python-Gevent </a> <a class="toc-link" data-tags="技术向" href="/2019/02/26/Python-underline.html"> 语言-Python-下划线汇总 </a> <a class="toc-link" data-tags="技术向" href="/2019/02/26/Python-lambda.html"> 语言-Python-lambda函数 </a> <a class="toc-link" data-tags="技术向" href="/2019/02/26/Python-click.html"> 语言-Python-click包 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/25/%E5%B9%B6%E5%8F%91%E5%92%8C%E5%B9%B6%E8%A1%8C.html"> 网络&操作系统-并发与并行 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/25/five-IO-models.html"> 网络&操作系统-linux五种IO模型 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/24/synchronous-asynchronous-blocking-non-blocking.html"> 网络&操作系统-异步，同步，阻塞，非阻塞 </a> <a class="toc-link" data-tags="技术向" href="/2019/02/24/Python-yield.html"> 语言-Python-yield的使用 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/20/cdn.html"> CDN 内容发放网络 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/15/pyspider%E9%98%85%E8%AF%BB%E8%AE%B0.html"> 源码阅读-pyspider源码阅读1 run.py </a> <a class="toc-link" data-tags="理解向" href="/2019/02/10/zombie.html"> 操作系统-僵尸进程，守护进程，孤儿进程 </a> <a class="toc-link" data-tags="理解向" href="/2019/01/20/nginx.html"> 网络-nginx </a> <a class="toc-link" data-tags="应用向" href="/2019/01/20/https-server.html"> 网络-Https服务器部署-Certbot </a> <a class="toc-link" data-tags="技术向" href="/2019/01/15/spider-lab2.html"> 网络-spider lab2 </a> <a class="toc-link" data-tags="技术向" href="/2019/01/15/spider-lab.html"> 网络-spider lab </a> <a class="toc-link" data-tags="读书笔记" href="/2019/01/12/Python3%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%982.html"> 《Python3 网络爬虫开发实战》第三章 </a> <a class="toc-link" data-tags="读书笔记" href="/2019/01/12/Python3%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%981.html"> 《Python3 网络爬虫开发实战》第二章 </a> <a class="toc-link" data-tags="技术向" href="/2019/01/10/MongoDB.html"> 数据库-MongoDB使用 </a> <a class="toc-link" data-tags="技术向" href="/2018/12/27/requests.html"> 网络-Python-requests包 </a> <a class="toc-link" data-tags="技术向" href="/2018/12/27/UTF-8-&-GBK.html"> 编码-GBK & UTF-8 </a> <a class="toc-link" data-tags="技术向" href="/2018/12/21/Python-%E6%8F%90%E9%AB%98.html"> 语言-Python-Python提高值Iterable，generator，Iterator </a> <a class="toc-link" data-tags="读书笔记" href="/2018/12/20/Linux-Shell-%E8%84%9A%E6%9C%AC%E6%94%BB%E7%95%A5.html"> 《Linux Shell 脚本攻略》 </a> <a class="toc-link" data-tags="读书笔记" href="/2018/12/12/Python%E5%85%A5%E9%97%A8.html"> 《Python入门》读书笔记 </a> <a class="toc-link" data-tags="技术向" href="/2018/11/10/Python-main%E5%87%BD%E6%95%B0.html"> 语言-Python-main函数 </a> <a class="toc-link" data-tags="技术向" href="/2018/10/20/HTML%E7%AC%94%E8%AE%B0.html"> 网络-HTML学习笔记 </a> <a class="toc-link" data-tags="技术向" href="/2018/10/12/decorator.html"> 语言-Python-decorator 装饰器 </a> <a class="toc-link" data-tags="理解向" href="/2018/10/10/server-frame-wsgi.html"> 网络-服务器，框架，应用，中间块详解 </a> <a class="toc-link" data-tags="技术向" href="/2018/10/10/flask-lab4.html"> 网络-flask lab4 </a> <a class="toc-link" data-tags="技术向" href="/2018/10/10/flask-lab3.html"> 网络-flask lab3 </a> <a class="toc-link" data-tags="技术向" href="/2018/10/10/flask-lab2.html"> 网络-flask lab2 </a> <a class="toc-link" data-tags="技术向" href="/2018/10/10/flask-lab.html"> 网络-flask lab </a> <a class="toc-link" data-tags="应用向" href="/2018/09/10/xmlrpc.html"> 网络-Python-xmlrpc </a> <a class="toc-link" data-tags="读书笔记" href="/2018/05/21/%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%9E%E6%8E%A5%E7%9A%84.html"> 《网络是怎样连接的》 </a> <a class="toc-link" data-tags="应用向" href="/2018/05/20/vim.html"> vim-操作汇总 </a> <a class="toc-link" data-tags="应用向" href="/2018/05/20/bash.html"> zsh/bash-常用命令 </a> <a class="toc-link" data-tags="应用向" href="/2018/05/20/linux-path.html"> 操作系统-Linux下的环境变量 </a> </nav> </div> </aside> <main id="main" class="open"> <article class="post container"> <div class="post-meta"> <span class="post-meta-span date">2019 January 10</span> <span class="post-meta-span tag">MongoDB, database</span> </div> <h1 class="post-title">数据库-MongoDB使用</h1> <h2 id="简介">简介</h2> <h3 id="nosqlnot-only-sql">NoSQL(Not Only SQL)</h3> <p>拥护者们提倡运用非关系型的数据存储。</p> <blockquote> <p>关系型数据库遵循<strong>ACID原则</strong>:</p> <ol> <li>Atomicity 原子性 事务里的操作要么全部做完，要么全不做</li> <li>Consistency 一致性 数据库要一直处于一直的状态，事务的运行不会改变数据库原本的一致性约束</li> <li>Isolation 独立性 并发的事物之间不会相互影响。如果一个事务正在访问的数据正在被另一个事务修改，只要另一个事务未提交</li> <li>Durability 持久性 一旦事务提交后，所做出的修改就会永久的保存在数据库中，即使出现宕机也不会丢失。</li> </ol> </blockquote> <h3 id="分布式系统distributed-sysytem">分布式系统(distributed sysytem)</h3> <blockquote> <p>由多台计算机和通信的软件组件通过计算机网络连接组成 是建立在网络上的软件系统 网络与分布式系统的区别更多的在于高层软件(特别是操作系统)，而不是硬件</p> </blockquote> <blockquote> <p>分布式计算的优点和缺点</p> </blockquote> <blockquote> <p>CAP定理 对于一个分布式系统来说，不可能同时满足以下三点</p> <ol> <li>一致性: 所有节点在同一时间有同样的数据</li> <li>可用性: 保证每个请求不管成功或失败都会有响应</li> <li>分隔容忍: 系统中任意信息的丢失或失败不会影响系统的继续运作</li> </ol> </blockquote> <h3 id="mongodb是文档型数据库">MongoDB是文档型数据库</h3> <p>由C++编写，基于分布式文件存储的开源数据系统。</p> <h2 id="mongodb基本概念">MongoDB基本概念</h2> <h3 id="数据库">数据库</h3> <p>一个MongoDB中可以建立多个数据库。MongoDB默认数据库为“db”，存放着在data目录中。 显示所有数据库的列表<code class="highlighter-rouge">show dbs</code></p> <p>显示当前数据库对象和集合<code class="highlighter-rouge">db</code></p> <p>连接到一个制定的数据库，若数据库不存在，则创建数据库<code class="highlighter-rouge">use XXX</code></p> <p>插入一条数据<code class="highlighter-rouge">db.XXX.insert({"XXX":"YYY"})</code></p> <p>MongoDB中默认数据库为test，需要用<code class="highlighter-rouge">use</code>进行切换 在MongoDB中集合只有在真正插入内容后才会被创建，也就是说创建集合后需要再插入一个文档。 删除数据库<code class="highlighter-rouge">db.dropDatabase</code> <strong>注意MongoDB是区分大小写的</strong></p> <h3 id="文档">文档</h3> <p>文档是一组键值对(BSON).mongodb的文档不需要相同的字段，相同的字段不需要相同的数据类型。一个简单的文档例子如下:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{"site":"chiyuanye.com", "name":"chiyuanye"}
</code></pre></div></div> <p>文档不能有重复的键。文档的键是字符串，除了少数例外情况，键可以使用任意UTF-8字符。</p> <h4 id="插入文档-dbcollection_nameinsertdocument">插入文档 <code class="highlighter-rouge">db.Collection_Name.insert(document)</code></h4> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;db.col.insert({title: 'MongoDB 教程', 
	description: 'MongoDB 是一个 Nosql 数据库',
	by: '菜鸟教程',
	url: 'http://www.runoob.com',
	tags: ['mongodb', 'database', 'NoSQL'],
	likes: 100
	})
</code></pre></div></div> <h4 id="更新文档">更新文档</h4> <p>先插入一条文档</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;db.col.insert({
	title: 'MongoDB 教程', 
	description: 'MongoDB 是一个 Nosql 数据库',
	by: '菜鸟教程',
	url: 'http://www.runoob.com',
	tags: ['mongodb', 'database', 'NoSQL'],
	likes: 100
})
</code></pre></div></div> <p>更新</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;db.col.updateOne({'title':'MongoDB 教程'},{$set:{'title':'MongoDB'}})
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })   # 输出信息

&gt; db.col.find().pretty()
{
	"_id" : ObjectId("56064f89ade2f21f36b03136"),
	"title" : "MongoDB",
	"description" : "MongoDB 是一个 Nosql 数据库",
	"by" : "菜鸟教程",
	"url" : "http://www.runoob.com",
	"tags" : [
		"mongodb",
		"database",
		"NoSQL"
	],
	"likes" : 100
}
&gt;
</code></pre></div></div> <p>如果要更新多个文档则用<code class="highlighter-rouge">updateMany()</code></p> <p>若要移除集合中的键值对，使用<code class="highlighter-rouge">$unset</code></p> <h4 id="删除文档">删除文档</h4> <p><code class="highlighter-rouge">db.Collection_Name.deleteMany({status:"A"})</code></p> <p><code class="highlighter-rouge">db.Collection_name.deleteOne({status:"D"})</code></p> <h4 id="查询文档">查询文档</h4> <p><code class="highlighter-rouge">db.Collection_Name.find(query, projection)</code>query指定查询条件，projection指定返回的键值</p> <p>加上<code class="highlighter-rouge">.pretty()</code>更易读</p> <p>加上<code class="highlighter-rouge">limit()</code>限制读取的记录条数</p> <p>加上<code class="highlighter-rouge">skip()</code>跳过指定数量的数据</p> <p>加上<code class="highlighter-rouge">sort({KEY:1})</code>根据指定参数排序，1为升序，-1为降序</p> <p><code class="highlighter-rouge">findOne()</code>只返回一个文档</p> <p>find()可以传入多个键，每个键用逗号隔开 <code class="highlighter-rouge">&gt;db.col.find({key1:value1, key2:value2}).pretty()</code></p> <h3 id="集合">集合</h3> <p>集合是MongoDB文档组。类似于RDBMS(relational database management system)z中的表格。 集合没有固定的结构，可以将不同格式和类型的文档插入集合中。</p> <blockquote> <p><strong>capped collections</strong> 就是指定大小的collection。具有高性能和队列过期的特性。能添加新的对象，能进行更新，但是不能增加存储空间。否则更新失败。</p> </blockquote> <p>创建集合<code class="highlighter-rouge">db.createCollection(name, options)</code></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; db.createCollection("mycol", { capped : true, autoIndexId : true, size : 
		   6142800, max : 10000 } )
{ "ok" : 1 }
</code></pre></div></div> <p>删除集合<code class="highlighter-rouge">db.Collection_Name.drop()</code></p> <h3 id="常见数据类型">常见数据类型</h3> <ol> <li>Objectid: 前四位表示unix时间戳，格林尼治GTC时间，接下来三位为机器识别码，紧接的两个字节为进程ID组成的PID，最后三个字节为随机数。 <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; var newObject = ObjectId()
&gt; newObject.getTimestamp()
ISODate("2017-11-25T07:21:10Z")
</code></pre></div> </div> </li> <li> <p>字符串 都是UTF-8编码</p> </li> <li>时间戳</li> <li>日期</li> </ol> <h2 id="type操作符">type操作符</h2> <ul> <li>(&gt;) 大于 - $gt</li> <li>(&lt;) 小于 - $lt</li> <li>(&gt;=) 大于等于 - $gte</li> <li>(&lt;= ) 小于等于 - $lte 现在已有这样一个集合 <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; db.col.find()
{ "_id" : ObjectId("56066542ade2f21f36b0313a"), "title" : "PHP 教程", "description" : "PHP 是一种创建动态交互性站点的强有力的服务器端脚本语言。", "by" : "菜鸟教程", "url" : "http://www.runoob.com", "tags" : [ "php" ], "likes" : 200 }
{ "_id" : ObjectId("56066549ade2f21f36b0313b"), "title" : "Java 教程", "description" : "Java 是由Sun Microsystems公司于1995年5月推出的高级程序设计语言。", "by" : "菜鸟教程", "url" : "http://www.runoob.com", "tags" : [ "java" ], "likes" : 150 }
{ "_id" : ObjectId("5606654fade2f21f36b0313c"), "title" : "MongoDB 教程", "description" : "MongoDB 是一个 Nosql 数据库", "by" : "菜鸟教程", "url" : "http://www.runoob.com", "tags" : [ "mongodb" ], "likes" : 100 }
</code></pre></div> </div> </li> </ul> <p><code class="highlighter-rouge">db.col.find({likes : {$gt : 100}})</code> 获取 “col” 集合中 “likes” 大于 100 的数据</p> <p><code class="highlighter-rouge">db.col.find({"title" : {$type : 2}})</code> 或 <code class="highlighter-rouge">db.col.find({"title" : {$type : 'string'}})</code> 来获取title中为String的数据</p> <h2 id="模糊查询">模糊查询</h2> <p>查询 title 包含”教”字的文档： <code class="highlighter-rouge">db.col.find({title:/教/})</code></p> <p>查询 title 字段以”教”字开头的文档： <code class="highlighter-rouge">db.col.find({title:/^教/})</code></p> <p>查询 titl e字段以”教”字结尾的文档： <code class="highlighter-rouge">db.col.find({title:/教$/})</code></p> <h2 id="mongodb连接">MongoDB连接</h2> <p>URI标准连接语法</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]
</code></pre></div></div> <h2 id="mongodb索引">MongoDB索引</h2> <blockquote> <p>索引是特殊的数据结构，存储在一个易于读取和遍历的数据集合中，索引是对数据库表中一列或多列的值进行排序的一种结构，通过B-Tree来实现</p> </blockquote> <p>MongoDB使用<code class="highlighter-rouge">createIndex()</code>方法来创建索引</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;db.collection.createIndex(keys, options)
</code></pre></div></div> <p>用创建了索引的参数会检索会快很多</p> <p>查看集合索引 <code class="highlighter-rouge">db.col.getIndexes()</code> 查看集合索引大小 <code class="highlighter-rouge">db.col.totalIndexSize()</code> 删除集合所有索引 <code class="highlighter-rouge">db.col.dropIndexes()</code> 删除集合指定索引 <code class="highlighter-rouge">db.col.dropIndex("索引名称")</code></p> <h3 id="利用唯一索引删除重复数据">利用唯一索引删除重复数据</h3> <ol> <li>将数据导出为JSON格式存档： <code class="highlighter-rouge">mongoexport.exe -d database_name -c collection_name -o filename.json</code></li> <li>清空当前集合的数据： <code class="highlighter-rouge">db.yourcollection.deleteMany({})</code></li> <li>新建唯一索引： <code class="highlighter-rouge">db.yourcollection.createIndex({public_no:1}, {unique:true})</code>唯一主键根据自己的想筛选的重复字段进行修改</li> <li>zsh中导入之前存档的JSON文件数据： <code class="highlighter-rouge">mongoimport -d database_name -c collection_name --upsert filename.json</code>upsert会避开唯一主键相同的字段 <em>注意要切换到合适的数据库，之前就是没有连接对应的数据库一直成功不了</em></li> </ol> <h2 id="mongodb-聚合">MongoDB 聚合</h2> </article> <div class="post-share"> <div class="container"> <a href="https://twitter.com/share?url=http://localhost:4000/2019/01/10/MongoDB.html&text=数据库-MongoDB使用" target="_blank" class="post-share-icon twitter"></a> <a href="https://www.evernote.com/clip.action?url=http://localhost:4000/2019/01/10/MongoDB.html&title=数据库-MongoDB使用" target="_blank" class="post-share-icon evernote"></a> <a href="http://service.weibo.com/share/share.php?url=http://localhost:4000/2019/01/10/MongoDB.html&title=数据库-MongoDB使用" target="_blank" class="post-share-icon weibo"></a> </div> </div> <div class="comment container"> <div id="disqus_thread"> </div> </div> <div class="footer"> <div class="container"> <p class="footer-entry">All content is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA</a></p> <p class="footer-entry">Built with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and <a href="https://github.com/P233/3-Jekyll" target="_blank">3-Jekyll theme</a> • Hosted on <a href="https://pages.github.com/" target="_blank">Github</a></p> </div> </div> </main> <button id="menu" class="open"> <span id="menu-icons"></span> </button> <button id="post-toc-menu"> <span id="post-toc-menu-icons"></span> </button> <div id="post-toc"> <span id="post-toc-title">Table of Contents</span> <ul id="post-toc-ul"></ul> </div> <script src="/assets/js/jquery-2.1.3.min.js"></script> <script src="/assets/js/jquery.pjax.js"></script> <script src="/assets/js/nprogress.js"></script> <script src="/assets/js/main.js"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-54767140-1', 'chiyuanye.com'); ga('send', 'pageview'); </script> </body> </html>
