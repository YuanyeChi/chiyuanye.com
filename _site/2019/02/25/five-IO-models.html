<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" /> <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]--> <meta name="author" content="Chi Yuanye"> <!--highlight--> <link rel="stylesheet" href="/css/main.css"> <link rel="stylesheet" type="text/css" href="/assets/css/syntax.monokai.css"> <link rel="shortcut icon" href="https://i.loli.net/2019/02/20/5c6cf0555ffe6.jpeg" /> <link rel="canonical" href="http://localhost:4000/2019/02/25/five-IO-models.html"> <!-- Begin Jekyll SEO tag v2.5.0 --> <title>网络&amp;操作系统-linux五种IO模型 | 池元烨的博客</title> <meta name="generator" content="Jekyll v3.8.5" /> <meta property="og:title" content="网络&amp;操作系统-linux五种IO模型" /> <meta name="author" content="Chi Yuanye" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="用户空间和内核空间 先来将Linux，为了保证内核的安全，操作系统将虚拟空间分为两部分。内核空间和供各个进程使用的用户空间。" /> <meta property="og:description" content="用户空间和内核空间 先来将Linux，为了保证内核的安全，操作系统将虚拟空间分为两部分。内核空间和供各个进程使用的用户空间。" /> <link rel="canonical" href="http://localhost:4000/2019/02/25/five-IO-models.html" /> <meta property="og:url" content="http://localhost:4000/2019/02/25/five-IO-models.html" /> <meta property="og:site_name" content="池元烨的博客" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2019-02-25T00:00:00+08:00" /> <script type="application/ld+json"> {"description":"用户空间和内核空间 先来将Linux，为了保证内核的安全，操作系统将虚拟空间分为两部分。内核空间和供各个进程使用的用户空间。","author":{"@type":"Person","name":"Chi Yuanye"},"@type":"BlogPosting","url":"http://localhost:4000/2019/02/25/five-IO-models.html","headline":"网络&amp;操作系统-linux五种IO模型","dateModified":"2019-02-25T00:00:00+08:00","datePublished":"2019-02-25T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2019/02/25/five-IO-models.html"},"@context":"http://schema.org"}</script> <!-- End Jekyll SEO tag --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="池元烨的博客" /> <meta name="baidu-site-verification" content="8IPSO1rIOM" /> <script src="/assets/js/prefixfree.js"></script> <!--百度推送--> <script> (function(){ var bp = document.createElement('script'); var curProtocol = window.location.protocol.split(':')[0]; if (curProtocol === 'https') { bp.src = 'https://zz.bdstatic.com/linksubmit/push.js'; } else { bp.src = 'http://push.zhanzhang.baidu.com/push.js'; } var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(bp, s); })(); </script> </head> <body> <aside id="sidebar" class="open"> <div id="sidebar-left"> <a id="sidebar-avatar" href="/"> <img id="sidebar-avatar-img" alt="" src="https://i.loli.net/2019/02/20/5c6cf0e7a42f9.jpg"/> </a> <div id="sidebar-social"> <a href="/pages/feed.xml" class="sidebar-social-icon feed"></a> <a href="mailto:yeyuan1489@gmail.com" class="sidebar-social-icon email"></a> <!-- Generate icon by yourself https://icomoon.io/app/#/select --> <a href="https://github.com/tsiye" class="sidebar-social-icon github" target="_blank"></a> <a href="https://www.instagram.com/tsiyuye" class="sidebar-social-icon instagram" target="_blank"></a> </div> <ul id="sidebar-tags"> <li class="sidebar-tag active" data-filter="recent">最新文章</li> <li class="sidebar-tag" data-filter="应用向">应用向</li> <li class="sidebar-tag" data-filter="读书笔记">读书笔记</li> <li class="sidebar-tag" data-filter="技术向">技术向</li> <li class="sidebar-tag" data-filter="理解向">理解向</li> <li class="sidebar-tag" data-filter="算法">算法</li> </ul> </div> <div id="sidebar-right"> <div id="search-box"> <input id="search-input" type="text" placeholder="Search" /> </div> <nav id="toc"> <a class="toc-link" data-tags="应用向" href="/2019/06/06/test.html"> Java大作业test </a> <a class="toc-link" data-tags="读书笔记" href="/2019/05/08/introduction-to-algo-DP.html"> 《算法导论》-动态规划问题 </a> <a class="toc-link" data-tags="" href="/2019/05/08/DP.html"> Dp </a> <a class="toc-link" data-tags="算法" href="/2019/04/26/external-sort2.html"> 算法-外部排序2 </a> <a class="toc-link" data-tags="应用向" href="/2019/04/22/github-ssh.html"> Git-关于github由https转为ssh </a> <a class="toc-link" data-tags="算法" href="/2019/04/20/single-and-double-linkedlist.html"> 数据结构-单双链表的区别 </a> <a class="toc-link" data-tags="应用向" href="/2019/04/16/blog-construction.html"> 本技术博客的搭建 </a> <a class="toc-link" data-tags="算法" href="/2019/04/16/external-sort.html"> 算法-外部排序1 </a> <a class="toc-link" data-tags="读书笔记" href="/2019/04/15/java-tools-3.html"> Java-《Java语言程序设计》关于一些工具数据类型的用法总结(二) 线性表list </a> <a class="toc-link" data-tags="读书笔记" href="/2019/04/15/java-tools-2.html"> Java-《Java语言程序设计》关于一些工具数据类型的用法总结(二) 合集collection和迭代器iterator </a> <a class="toc-link" data-tags="应用向" href="/2019/04/11/ss.html"> ubuntu-ss的一些配置 </a> <a class="toc-link" data-tags="理解向" href="/2019/03/30/file-descriptor.html"> 操作系统-文件描述符 </a> <a class="toc-link" data-tags="技术向" href="/2019/03/28/Nagel.html"> 网络-Nagel算法＆Delay ACK </a> <a class="toc-link" data-tags="技术向" href="/2019/03/28/redis.html"> 数据库-Redis类型和使用场景 </a> <a class="toc-link" data-tags="理解向" href="/2019/03/26/java-PrintStream-PrintWriter.html"> Java-IO总览 </a> <a class="toc-link" data-tags="算法" href="/2019/03/26/PLS.html"> 算法-PLS(偏最小二乘回归)以及相关概念 </a> <a class="toc-link" data-tags="应用向" href="/2019/03/24/ubuntu-tools.html"> ubuntu-一些好用的工具 </a> <a class="toc-link" data-tags="算法" href="/2019/03/24/backtracking.html"> 算法-backtracking(回溯法) </a> <a class="toc-link" data-tags="技术向" href="/2019/03/19/java-comparator-comparable.html"> Java-comparator & comparable </a> <a class="toc-link" data-tags="算法" href="/2019/03/18/sentinel.html"> 算法-哨兵 </a> <a class="toc-link" data-tags="算法" href="/2019/03/18/resources.html"> 算法-一些资源 </a> <a class="toc-link" data-tags="应用向" href="/2019/03/16/zsh-hot-key.html"> zsh-快捷键 </a> <a class="toc-link" data-tags="读书笔记" href="/2019/03/11/java-tools-1.html"> Java-《Java语言程序设计》关于一些工具数据类型的用法总结(一) 数组 Math 字符串 </a> <a class="toc-link" data-tags="读书笔记" href="/2019/03/10/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F.html"> 《深入理解计算机系统》 </a> <a class="toc-link" data-tags="应用向" href="/2019/03/09/ps-vs-top.html"> 操作系统-ps & top </a> <a class="toc-link" data-tags="读书笔记" href="/2019/03/09/%E7%8E%B0%E4%BB%A3%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.html"> 现代操作系统-第一章-引论 </a> <a class="toc-link" data-tags="算法" href="/2019/03/09/operators.html"> 算法-运算符 </a> <a class="toc-link" data-tags="应用向" href="/2019/03/07/tcpip-osi.html"> 网络-TCP/IP&OSI </a> <a class="toc-link" data-tags="理解向" href="/2019/03/07/http-https.html"> 网络-Http&Https </a> <a class="toc-link" data-tags="技术向" href="/2019/03/06/socks.html"> 网络-socks </a> <a class="toc-link" data-tags="理解向" href="/2019/03/06/efficiency-of-server.html"> 操作系统-影响服务器性能的四大杀手 </a> <a class="toc-link" data-tags="理解向" href="/2019/03/05/dirty-read-nonrepeatable-read-phantom-read.html"> 数据库&分布式-脏读，幻读，不可重复读 事务的隔离性 </a> <a class="toc-link" data-tags="技术向" href="/2019/03/05/MongoDB-Redis-Memcached.html"> 数据库-Redis，Memcached,MongoDB比较 </a> <a class="toc-link" data-tags="技术向" href="/2019/03/05/ACID-CAP.html"> 数据库&分布式-ACID & CAP/BASE </a> <a class="toc-link" data-tags="技术向" href="/2019/03/04/db-type.html"> 数据库-大致分类 </a> <a class="toc-link" data-tags="算法" href="/2019/03/04/sort.html"> 算法-几种排序的介绍 </a> <a class="toc-link" data-tags="理解向" href="/2019/03/03/limited-server.html"> 网络-服务器限流以及突破服务器限流, 爬虫与反爬 </a> <a class="toc-link" data-tags="应用向" href="/2019/03/03/java-path.html"> Java环境配置 </a> <a class="toc-link" data-tags="应用向" href="/2019/03/03/git.html"> 技巧-git命令汇总 </a> <a class="toc-link" data-tags="算法" href="/2019/03/03/rand.html"> 算法-一种rand表示另一种 </a> <a class="toc-link" data-tags="应用向" href="/2019/03/02/docker.html"> docker </a> <a class="toc-link" data-tags="理解向" href="/2019/03/01/pyspider%E9%98%85%E8%AF%BB%E8%AE%B0.html"> 源码阅读-pyspider源码阅读3 tornado_fetcher.py </a> <a class="toc-link" data-tags="应用向" href="/2019/02/28/messagepack.html"> 网络-Python-messagePack </a> <a class="toc-link" data-tags="理解向" href="/2019/02/28/copy-&-deepcopy.html"> 语言-Python-深浅拷贝 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/27/Python-metaclass.html"> 语言-Python-元类 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/27/in-memry-vs-on-disk.html"> 数据库-内存数据库和磁盘数据库的对比 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/26/pyspider%E9%98%85%E8%AF%BB%E8%AE%B0.html"> 源码阅读-pyspider源码阅读2 app.py </a> <a class="toc-link" data-tags="理解向" href="/2019/02/26/Tornado.html"> 网络-Python-Tornado </a> <a class="toc-link" data-tags="理解向" href="/2019/02/26/Multiplexing.html"> 网络&操作系统-IO多路复用 select poll epoll </a> <a class="toc-link" data-tags="技术向" href="/2019/02/26/Gevent.html"> 网络-Python-Gevent </a> <a class="toc-link" data-tags="技术向" href="/2019/02/26/Python-underline.html"> 语言-Python-下划线汇总 </a> <a class="toc-link" data-tags="技术向" href="/2019/02/26/Python-lambda.html"> 语言-Python-lambda函数 </a> <a class="toc-link" data-tags="技术向" href="/2019/02/26/Python-click.html"> 语言-Python-click包 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/25/%E5%B9%B6%E5%8F%91%E5%92%8C%E5%B9%B6%E8%A1%8C.html"> 网络&操作系统-并发与并行 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/25/five-IO-models.html"> 网络&操作系统-linux五种IO模型 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/24/synchronous-asynchronous-blocking-non-blocking.html"> 网络&操作系统-异步，同步，阻塞，非阻塞 </a> <a class="toc-link" data-tags="技术向" href="/2019/02/24/Python-yield.html"> 语言-Python-yield的使用 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/20/cdn.html"> CDN 内容发放网络 </a> <a class="toc-link" data-tags="理解向" href="/2019/02/15/pyspider%E9%98%85%E8%AF%BB%E8%AE%B0.html"> 源码阅读-pyspider源码阅读1 run.py </a> <a class="toc-link" data-tags="理解向" href="/2019/02/10/zombie.html"> 操作系统-僵尸进程，守护进程，孤儿进程 </a> <a class="toc-link" data-tags="理解向" href="/2019/01/20/nginx.html"> 网络-nginx </a> <a class="toc-link" data-tags="应用向" href="/2019/01/20/https-server.html"> 网络-Https服务器部署-Certbot </a> <a class="toc-link" data-tags="技术向" href="/2019/01/15/spider-lab2.html"> 网络-spider lab2 </a> <a class="toc-link" data-tags="技术向" href="/2019/01/15/spider-lab.html"> 网络-spider lab </a> <a class="toc-link" data-tags="读书笔记" href="/2019/01/12/Python3%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%982.html"> 《Python3 网络爬虫开发实战》第三章 </a> <a class="toc-link" data-tags="读书笔记" href="/2019/01/12/Python3%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%981.html"> 《Python3 网络爬虫开发实战》第二章 </a> <a class="toc-link" data-tags="技术向" href="/2019/01/10/MongoDB.html"> 数据库-MongoDB使用 </a> <a class="toc-link" data-tags="技术向" href="/2018/12/27/requests.html"> 网络-Python-requests包 </a> <a class="toc-link" data-tags="技术向" href="/2018/12/27/UTF-8-&-GBK.html"> 编码-GBK & UTF-8 </a> <a class="toc-link" data-tags="技术向" href="/2018/12/21/Python-%E6%8F%90%E9%AB%98.html"> 语言-Python-Python提高值Iterable，generator，Iterator </a> <a class="toc-link" data-tags="读书笔记" href="/2018/12/20/Linux-Shell-%E8%84%9A%E6%9C%AC%E6%94%BB%E7%95%A5.html"> 《Linux Shell 脚本攻略》 </a> <a class="toc-link" data-tags="读书笔记" href="/2018/12/12/Python%E5%85%A5%E9%97%A8.html"> 《Python入门》读书笔记 </a> <a class="toc-link" data-tags="技术向" href="/2018/11/10/Python-main%E5%87%BD%E6%95%B0.html"> 语言-Python-main函数 </a> <a class="toc-link" data-tags="技术向" href="/2018/10/20/HTML%E7%AC%94%E8%AE%B0.html"> 网络-HTML学习笔记 </a> <a class="toc-link" data-tags="技术向" href="/2018/10/12/decorator.html"> 语言-Python-decorator 装饰器 </a> <a class="toc-link" data-tags="理解向" href="/2018/10/10/server-frame-wsgi.html"> 网络-服务器，框架，应用，中间块详解 </a> <a class="toc-link" data-tags="技术向" href="/2018/10/10/flask-lab4.html"> 网络-flask lab4 </a> <a class="toc-link" data-tags="技术向" href="/2018/10/10/flask-lab3.html"> 网络-flask lab3 </a> <a class="toc-link" data-tags="技术向" href="/2018/10/10/flask-lab2.html"> 网络-flask lab2 </a> <a class="toc-link" data-tags="技术向" href="/2018/10/10/flask-lab.html"> 网络-flask lab </a> <a class="toc-link" data-tags="应用向" href="/2018/09/10/xmlrpc.html"> 网络-Python-xmlrpc </a> <a class="toc-link" data-tags="读书笔记" href="/2018/05/21/%E7%BD%91%E7%BB%9C%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%9E%E6%8E%A5%E7%9A%84.html"> 《网络是怎样连接的》 </a> <a class="toc-link" data-tags="应用向" href="/2018/05/20/vim.html"> vim-操作汇总 </a> <a class="toc-link" data-tags="应用向" href="/2018/05/20/bash.html"> zsh/bash-常用命令 </a> <a class="toc-link" data-tags="应用向" href="/2018/05/20/linux-path.html"> 操作系统-Linux下的环境变量 </a> </nav> </div> </aside> <main id="main" class="open"> <article class="post container"> <div class="post-meta"> <span class="post-meta-span date">2019 February 25</span> <span class="post-meta-span tag">web, OS</span> </div> <h1 class="post-title">网络&操作系统-linux五种IO模型</h1> <h2 id="用户空间和内核空间">用户空间和内核空间</h2> <p>先来将Linux，为了保证内核的安全，操作系统将虚拟空间分为两部分。内核空间和供各个进程使用的用户空间。</p> <h2 id="进程切换进程阻塞">进程切换&amp;进程阻塞</h2> <p>进程切换:为了调配各个进程的运行，cpu必须有能力挂起在其上运行的进程，并恢复之前挂起的某个进程的运行。这其中发生了: 1. 保存处理机上下文，包括程序计数器和其他寄存器。 2. 更新PCB信息。 3. 把进程的PCB移入相应的队列，如就绪、在某事件阻塞等队列。 4. 选择另一个进程执行，并更新其PCB。 5. 更新内存管理的数据结构。 6. 恢复处理机上下文。 总之是十分的耗费资源。</p> <p>进程阻塞:正在执行的进程，由于期待的某些事情未能发生，如系统资源请求失败，新数据尚未到达，或者无新工作等，则由系统自动执行阻塞原语(Block)。这是进程自身的一种行为。进入阻塞后，是不占用CPU的。</p> <blockquote> <p>这里插播一下进程的有关概念。在类Unix系统中，进程是由<strong>进程控制块(process control block,PCB)</strong>，进程执行的程序，进程执行时的所用数据，进程运行使用的工作区组成。 PCB记录了操作系统所需的用于描述进程当前情况以及控制进程运行的全部信息。是进程存在的唯一标识。 OS是根据PCB来对并发执行的进程进行控制和管理的.</p> </blockquote> <h2 id="文件描述符file-descriptor">文件描述符(File descriptor)</h2> <blockquote> <p>指向文件的引用</p> </blockquote> <p>文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。</p> <h2 id="io">I/O</h2> <h3 id="缓存io">缓存I/O</h3> <p>大多数文件系统的默认I/O操作都是缓存I/O。此机制下,数据先被拷贝到内核的缓冲区中，然后才会从缓冲区拷贝到应用程序的地址空间。 <strong>缺点</strong>:内存开销极大</p> <h3 id="linux-io模型">Linux I/O模型</h3> <blockquote> <p>网络IO的本质是socket的读取，socket在linux系统被抽象为流，IO可以理解为对流的操作。</p> </blockquote> <p>当发生一个read操作时，会经历两个阶段:</p> <ol> <li>等待数据准备</li> <li>将数据从内核拷贝到进程中</li> </ol> <p>对socket流而言:</p> <ol> <li> <p>通常涉及等待网络上的数据分组到达，然后被复制到内核的某个缓冲区。</p> </li> <li> <p>把数据从内核缓冲区复制到应用进程缓冲区。</p> </li> </ol> <p>因为这两个阶段，linux产生了以下五种I/O网络模式 - 阻塞 I/O（blocking IO） - 非阻塞 I/O（nonblocking IO） - I/O 多路复用（ IO multiplexing） - 信号驱动 I/O（ signal driven IO） - 异步 I/O（asynchronous IO）</p> <h3 id="socket-套接字">socket 套接字</h3> <p>先来复习一下套接字，<strong>这是计算机网络中进程间数据流的端点</strong>，也是<strong>操作系统提供的进程间通讯机制</strong> 在操作系统中，通常为应用程序提供一组API，成为套接字接口。应用程序可以通过这个来使用网络套接字进行数据交换。 在套接字接口中，<strong>IP地址</strong>和<strong>通信端口</strong>组成套接字地址(socket address)。本地与远程的套接字地址完成连线后再加上使用的协议(protocol),这个五元组称为套接字对。之后就可以彼此交换数据。 e.g 在同一台计算机上，TCP和UDP协议可以使用同一个port而互不干扰，是因为五元组中的协议不同。</p> <h3 id="同步阻塞io-blocking-io">同步阻塞I/O (blocking IO)</h3> <p>在linux中，默认所有的socket都是blocking。</p> <ol> <li>用户进程进行了系统调用，kernel开始IO第一阶段，准备数据。(对于很多网络IO来说，很多时候数据一开始都没有到达。所以这个时候kernel就需要等待)</li> <li>用户进程这边整个进程就会被阻塞(自己选择阻塞)。</li> <li>kernel数据准备好了之后，会将数据从kernel中拷贝到用户内存。</li> <li>用户进程解除block状态，重新运行。 <blockquote> <p>blocking IO的特点就是在IO执行的两个阶段都被block了</p> </blockquote> </li> </ol> <p>优点</p> <blockquote> <p>能及时返回数据 无延迟 对内核开发者来说省事</p> </blockquote> <p>缺点</p> <blockquote> <p>对用户来说要付出性能的代价</p> </blockquote> <h3 id="同步非阻塞io-nonblocking-io">同步非阻塞IO (nonblocking IO)</h3> <blockquote> <p>过一会瞄一眼进度条 <strong>轮询(polling)</strong>方式 可以通过设置socket变为non-blocking。 在网络IO时候，非阻塞IO也会进行recvform系统调用，检查数据是否准备好，与阻塞IO不一样，”非阻塞将大的整片时间的阻塞分成N多的小的阻塞, 所以进程不断地有机会 ‘被’ CPU光顾”。</p> <ol> <li>当用户进程发起read操作时，如果kernel中的数据未准备好，会立刻返回一个error</li> <li>用户知道没准备好，先干会别的事情。再次发送read操作。</li> <li>如果还没准备好，内核还会返回一个error。</li> <li>一旦内核准备好了，就会把数据拷贝到用户内存然后返回。</li> <li>需要注意<strong>拷贝数据整个过程，进程仍然是属于阻塞的状态</strong> nonblocking IO的特点是用户进程需要不断的主动询问kernel数据好了没有</li> </ol> </blockquote> <p>相比于同步阻塞 优点</p> <blockquote> <p>能够在任务完成时间内干其他活</p> </blockquote> <p>缺点</p> <blockquote> <p>任务完成的响应延迟增大了，任务可能在两次轮询之间完成。减少了整体数据的吞吐量。</p> </blockquote> <h3 id="io多路复用io-multiplexing">IO多路复用(IO multiplexing)</h3> <p>同步非阻塞方式需要不断主动轮询，轮询占据了很大一部分过程，轮询会消耗大量的CPU时间，而 “后台” 可能有多个任务在同时进行，人们就想到了循环查询多个任务的完成状态，只要有任何一个任务完成，就去处理它。UNIX/Linux 下的 select、poll、epoll 就是干这个的（epoll 比 poll、select 效率高，做的事情是一样的）。</p> <blockquote> <p>IO multiplexing就是我们说的select，poll，epoll，有些地方也称这种IO方式为event driven IO。</p> </blockquote> <p>select调用是内核级别的。select和poll调用之后，内核会监视到达的数据。同时会阻塞监视的一批进程。有数据可以读写时就会调用IO操作函数。</p> <p>select/epoll的好处就在于<strong>单个process就可以同时处理多个网络连接的IO</strong>。它的基本原理就是select，poll，epoll这个function会不断的轮询所负责的所有socket，当某个socket有数据到达了，就通知用户进程。</p> <blockquote> <p>所以，如果处理的连接数不是很高的话，使用select/epoll的web server不一定比使用multi-threading + blocking IO的web server性能更好，可能延迟还更大。（select/epoll的优势并不是对于单个连接能处理得更快，而是在于能处理更多的连接。同时系统开销小。）</p> </blockquote> <p>IO多路复用是阻塞在select，epoll这样的系统调用之上，而没有阻塞在真正的I/O系统调用如recvfrom之上。归为同步阻塞模型</p> <h4 id="主要应用场景">主要应用场景</h4> <ol> <li>服务器需要同时处理多个处于监听状态或者多个连接状态的套接字。</li> <li>服务器需要同时处理多种网络协议的套接字。</li> </ol> <blockquote> <p>到此为止，前三种IO模式，是用户进程进行系统调用时，处理方式不一样。直接等待，轮询，select或poll轮询。两个阶段过程：</p> <ul> <li>第一个阶段有的阻塞，有的不阻塞，有的可以阻塞又可以不阻塞。</li> <li>第二个阶段都是阻塞的。</li> <li>从整个IO来看，都是顺序进行的，可以归为同步模型。都是进程主动等待且向内核检查状态(向存储设备或者网络)。</li> </ul> </blockquote> <h3 id="信号驱动式iosignal-driven-io">信号驱动式IO(signal-driven IO)</h3> <blockquote> <p>首先我们允许Socket进行信号驱动IO,并安装一个信号处理函数，进程继续运行并不阻塞。当数据准备好时，进程会收到一个SIGIO信号，可以在信号处理函数中调用I/O操作函数处理数据。 数据准备阶段的异步非阻塞</p> </blockquote> <h3 id="异步非阻塞ioasynchronous-io">异步非阻塞IO(asynchronous IO)</h3> <blockquote> <p>相对于同步IO，异步IO不是顺序执行。用户进程进行aio_read系统调用之后，无论内核数据是否准备好，都会直接返回给用户进程，然后用户态进程可以去做别的事情。等到socket数据准备好了，内核直接复制数据给进程，然后从内核向进程发送通知(通过signal或者一个基于线程的回调函数)。IO两个阶段，进程都是非阻塞的。 如果进程在忙着做一般的其他事，一般是强行打断，将时间登记一下放进队列，然后返回进程原来在做的事。 如果进程正在内核态忙着做其他别的事，例如以同步阻塞方式读写磁盘，只能把通知挂起，等内核态事情忙完了，快回用户态时，再触发通知。 如果进程被挂起，无事可做sleep了，就把这个进程唤醒，下次有cpu空闲就会调度到这个进程。</p> </blockquote> <h3 id="异步阻塞io">异步阻塞IO</h3> <ul> <li>有时候需要做完一件事后再做另一件事，这就需要调用者以阻塞方式来工作。</li> <li>还有一种情况，对实时系统或者延迟敏感的事务，有时候采用阻塞方式比非阻塞方式要好。</li> </ul> <p><img src="/assets/img/five-IO.png" alt="" /> 通过上面的图片，可以发现non-blocking IO和asynchronous IO的区别还是很明显的。在non-blocking IO中，虽然进程大部分时间都不会被block，但是它仍然要求进程去主动的check，并且当数据准备完成以后，也需要进程主动的再次调用recvfrom来将数据拷贝到用户内存。而asynchronous IO则完全不同。它就像是用户进程将整个IO操作交给了他人（kernel）完成，然后他人做完后发信号通知。在此期间，用户进程不需要去检查IO操作的状态，也不需要主动的去拷贝数据。</p> <h2 id="reference">reference</h2> <p><a href="https://www.jianshu.com/p/486b0965c296">聊聊Linux 五种IO模型</a></p> </article> <div class="post-share"> <div class="container"> <a href="https://twitter.com/share?url=http://localhost:4000/2019/02/25/five-IO-models.html&text=网络&操作系统-linux五种IO模型" target="_blank" class="post-share-icon twitter"></a> <a href="https://www.evernote.com/clip.action?url=http://localhost:4000/2019/02/25/five-IO-models.html&title=网络&操作系统-linux五种IO模型" target="_blank" class="post-share-icon evernote"></a> <a href="http://service.weibo.com/share/share.php?url=http://localhost:4000/2019/02/25/five-IO-models.html&title=网络&操作系统-linux五种IO模型" target="_blank" class="post-share-icon weibo"></a> </div> </div> <div class="comment container"> <div id="disqus_thread"> </div> </div> <div class="footer"> <div class="container"> <p class="footer-entry">All content is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA</a></p> <p class="footer-entry">Built with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and <a href="https://github.com/P233/3-Jekyll" target="_blank">3-Jekyll theme</a> • Hosted on <a href="https://pages.github.com/" target="_blank">Github</a></p> </div> </div> </main> <button id="menu" class="open"> <span id="menu-icons"></span> </button> <button id="post-toc-menu"> <span id="post-toc-menu-icons"></span> </button> <div id="post-toc"> <span id="post-toc-title">Table of Contents</span> <ul id="post-toc-ul"></ul> </div> <script src="/assets/js/jquery-2.1.3.min.js"></script> <script src="/assets/js/jquery.pjax.js"></script> <script src="/assets/js/nprogress.js"></script> <script src="/assets/js/main.js"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-54767140-1', 'chiyuanye.com'); ga('send', 'pageview'); </script> </body> </html>
